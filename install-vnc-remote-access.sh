#!/bin/bash

# ============================================================================
# üì¶ install-vnc-remote-access.sh (–±–µ–∑ –ø–∞—Ä–æ–ª–∏)
# ----------------------------------------------------------------------------
# –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞ XFCE + TigerVNC —Å clipboard sync, –¥–æ—Å—Ç—ä–ø–µ–Ω –±–µ–∑ –ø–∞—Ä–æ–ª–∞
# ============================================================================
# –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –∑–∞ –≤—ä—Ç—Ä–µ—à–Ω–∏ –∏–ª–∏ –æ–±—É—á–∏—Ç–µ–ª–Ω–∏ –º–∞—à–∏–Ω–∏, –±–µ–∑ –Ω—É–∂–¥–∞ –æ—Ç –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è.
# ============================================================================

echo "üñ•Ô∏è –ò–Ω—Å—Ç–∞–ª–∞—Ü–∏—è –Ω–∞ XFCE + TigerVNC (–±–µ–∑ –ø–∞—Ä–æ–ª–∏)..."
echo "-------------------------------------------------------------------------"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ root
if [[ "$EUID" -ne 0 ]]; then
  echo "‚ùå –°–∫—Ä–∏–ø—Ç—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –∏–∑–ø—ä–ª–Ω–∏ —Å root –ø—Ä–∞–≤–∞ (sudo)."
  exit 1
fi

USER_HOME=$(eval echo "~$SUDO_USER")
USER_VNC_DIR="$USER_HOME/.vnc"

# –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ –Ω—É–∂–Ω–∏—Ç–µ –ø–∞–∫–µ—Ç–∏
apt update && apt install -y \
  xfce4 xfce4-goodies \
  tigervnc-standalone-server \
  autocutsel

# –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ .vnc –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
sudo -u "$SUDO_USER" mkdir -p "$USER_VNC_DIR"

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–µ –Ω–∞ xstartup
cat > "$USER_VNC_DIR/xstartup" << 'EOF'
#!/bin/sh
xrdb $HOME/.Xresources
autocutsel -fork
startxfce4 &
EOF

chmod +x "$USER_VNC_DIR/xstartup"
chown "$SUDO_USER":"$SUDO_USER" "$USER_VNC_DIR/xstartup"

# –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Å—Ç–∞—Ä–∞ –ø–∞—Ä–æ–ª–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–µ –Ω–∞ "–±–µ–∑ –∑–∞—â–∏—Ç–∞"
sudo -u "$SUDO_USER" rm -f "$USER_VNC_DIR/passwd"

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ permanent securitytypes=none
cat > "$USER_VNC_DIR/config" <<EOF
securitytypes=none
EOF

chown "$SUDO_USER":"$SUDO_USER" "$USER_VNC_DIR/config"

# –°—Ç–∞—Ä—Ç –∏ —Å—Ç–æ–ø –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
echo "üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ VNC..."
sudo -u "$SUDO_USER" vncserver :1
sudo -u "$SUDO_USER" vncserver -kill :1

# –§–∏–Ω–∞–ª–Ω–æ —Å—ä–æ–±—â–µ–Ω–∏–µ
echo
echo "‚úÖ VNC —Å—ä—Ä–≤—ä—Ä—ä—Ç –µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω –±–µ–∑ –ø–∞—Ä–æ–ª–∞."
echo "üìé –°–≤—ä—Ä–∂–∏ —Å–µ –Ω–∞: <IP>:5901"
echo "üõ°Ô∏è –ó–∞ –¥–æ—Å—Ç—ä–ø –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–∏—Å–∫, –ø—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ –µ –¥–∞ —Ä–∞–±–æ—Ç–∏ —Å–∞–º–æ –ø—Ä–µ–∑ VPN –∏–ª–∏ –∑–∞—â–∏—Ç–µ–Ω–∞ –º—Ä–µ–∂–∞."
echo ""
echo "‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç:   vncserver :1"
echo "‚õî –°—Ç–æ–ø:    vncserver -kill :1"

